// Function to add a new process to the processes list
function addProcess(processTitle) {
    const processList = document.getElementById('processList');

    const processItem = document.createElement('div');
    processItem.classList.add('process-item');

    const processTitleElem = document.createElement('div');
    processTitleElem.classList.add('process-title');
    processTitleElem.innerText = processTitle;

    const processProgressContainer = document.createElement('div');
    processProgressContainer.classList.add('process-progress');
    const progressBar = document.createElement('div');
    progressBar.classList.add('progress-bar');
    progressBar.style.width = '0%';  // Initialize progress to 0%
    progressBar.setAttribute('role', 'progressbar');
    progressBar.setAttribute('aria-valuenow', '0');
    progressBar.setAttribute('aria-valuemin', '0');
    progressBar.setAttribute('aria-valuemax', '100');
    processProgressContainer.appendChild(progressBar);

    const processStatus = document.createElement('div');
    processStatus.classList.add('process-status');
    processStatus.innerText = 'In Progress...';

    processItem.appendChild(processTitleElem);
    processItem.appendChild(processProgressContainer);
    processItem.appendChild(processStatus);

    processList.appendChild(processItem);

    return { processItem, progressBar, processStatus };
}

// Function to update the process progress
function updateProcessProgress(progressBar, processStatus, progress) {
    progressBar.style.width = progress + '%';
    progressBar.setAttribute('aria-valuenow', progress);
    if (progress === 100) {
        processStatus.innerText = 'Completed';
    } else {
        processStatus.innerText = 'In Progress...';
    }
}

// Example usage: Add a new process when the form is submitted
document.getElementById('shareForm').addEventListener('submit', async (event) => {
    event.preventDefault();
    const cookies = document.getElementById('cookies').value;
    const fbLink = document.getElementById('urls').value;
    const shareCount = parseInt(document.getElementById('amounts').value);
    const interval = parseFloat(document.getElementById('intervals').value);

    // Initialize process
    const { processItem, progressBar, processStatus } = addProcess('Sharing Post...');

    try {
        const response = await fetch(apiEndpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                cookies: JSON.parse(cookies),
                fbLink,
                shareCount,
                interval
            })
        });

        const result = await response.json();
        if (result.message) {
            // Update progress bar to 100% and change status to completed
            updateProcessProgress(progressBar, processStatus, 100);
            document.getElementById('result').innerText = result.message;
        }
    } catch (error) {
        console.error(error);
        document.getElementById('result').innerText = "Error while processing the request.";
    }
});
